import { useQuery } from '@tanstack/react-query';
import { QUERIES } from 'modules/Shared/constants/queries';
import { useAgentContext } from 'modules/Agent/hooks';
import VulnerabilityService from 'modules/Vulnerability/api/VulnerabilityService';
import { useVulnerabilityContext } from 'modules/Vulnerability/contexts/VulnerabilityContext';

export const useAgentVulnerabilitiesQuery = () => {
  const { selectedAgentId } = useAgentContext();
  const { formattedVulnerabilityFilters } = useVulnerabilityContext();

  const {
    isLoading: getAgentVulnerabilitiesIsLoading,
    data: getAgentVulnerabilitiesData,
  } = useQuery(
    [
      QUERIES.VULNERABILITY.GET_AGENT_VULNERABILITIES,
      selectedAgentId,
      formattedVulnerabilityFilters,
    ],
    () =>
      VulnerabilityService.getAgentVulnerabilities(
        selectedAgentId!,
        formattedVulnerabilityFilters
      )
  );

  return {
    getAgentVulnerabilitiesData: getAgentVulnerabilitiesData || [],
    getAgentVulnerabilitiesIsLoading,
  };
};
