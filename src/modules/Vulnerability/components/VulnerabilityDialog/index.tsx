import { DefaultDialog } from 'modules/Shared/components';
import { useVulnerabilityContext } from 'modules/Vulnerability/contexts/VulnerabilityContext';
import { useAgentContext } from 'modules/Agent/hooks';
import { useState } from 'react';
import { TabContext, TabList, TabPanel } from '@mui/lab';
import { Tab } from '@mui/material';
import Events from 'modules/Vulnerability/components/VulnerabilityDialog/Events';
import Overview from './Overview';

const VulnerabilityDialog = () => {
  const [tab, setTab] = useState('1');
  const { selectedVulnerability, setSelectedVulnerability } =
    useVulnerabilityContext();
  const { selectedAgent } = useAgentContext();

  const onclose = () => {
    setSelectedVulnerability(null);
  };

  return (
    <DefaultDialog
      open={!!selectedVulnerability}
      onClose={onclose}
      title={`${selectedAgent?.generalData.elasticsearchName} - ${selectedVulnerability?.title}`}
    >
      <TabContext value={tab}>
        <TabList onChange={(e, v) => setTab(v)}>
          <Tab label="Overview" value="1" />
          <Tab label="Related Events" value="2" />
        </TabList>
        <TabPanel value="1">
          <Overview />
        </TabPanel>
        <TabPanel sx={{ flex: 1 }} value="2">
          <Events />
        </TabPanel>
      </TabContext>
    </DefaultDialog>
  );
};

export default VulnerabilityDialog;
